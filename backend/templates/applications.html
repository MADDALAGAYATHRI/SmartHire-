{% extends "base.html" %}

{% block title %}My Applications - SmartHire{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

  <h1 class="text-2xl font-bold text-gray-900 mb-6">My Applications</h1>

  <div id="applications-list" class="space-y-6">
    <p class="text-gray-500">Loading applications...</p>
  </div>

</div>


<script>
async function loadApplications() {
  try {
    const res = await fetch("/api/my_applications"); // <-- API endpoint for seeker applications
    const apps = await res.json();

    const list = document.getElementById("applications-list");
    list.innerHTML = "";

    if (!apps.length) {
      list.innerHTML = "<p class='text-gray-500'>You haven’t applied to any jobs yet.</p>";
      return;
    }

    apps.forEach(app => {
      const div = document.createElement("div");
      div.className = "bg-white shadow rounded-lg p-6";

      let html = `
        <h2 class="text-xl font-semibold text-gray-900">${app.job_title}</h2>
        <p class="text-gray-600">${app.department || "No department"} • ${app.location || "Remote"}</p>
        <p class="text-gray-500 mt-1">${app.salary_range || ""}</p>

        <div class="mt-4">
          <p class="text-sm text-gray-700"><b>Status:</b> 
            <span class="px-2 py-1 text-xs rounded-full ${
              app.status === "shortlisted" ? "bg-green-100 text-green-800" :
              app.status === "rejected" ? "bg-red-100 text-red-800" :
              "bg-gray-100 text-gray-800"
            }">${app.status || "Under Review"}</span>
          </p>

          <p class="text-sm text-gray-700 mt-2"><b>ATS Score:</b> ${app.score || "N/A"}%</p>
        </div>

        <div class="mt-4">
          <a href="/jobs/${app.job_id}" 
             class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">
            View Job
          </a>
        </div>
      `;

      div.innerHTML = html;
      list.appendChild(div);
    });
  } catch (err) {
    console.error("Error loading applications:", err);
  }
}

loadApplications();
</script>
{% endblock %}
